<!DOCTYPE html>
<html><head>
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

   
    <meta name="author" content="jxsrlsl1234">
  

   
    
    
    
    
    
    
    <meta name="keywords" content="theme,kagome">
  

  

  <meta name="generator" content="Hugo 0.87.0" />
  
  
  
  
  
  
  <title>SpringMVCé¡¹ç›®ä¸­WebApplicationContextæ˜¯å¦‚ä½•æ„å»ºå‡ºæ¥çš„ ğŸŒŸ éæ´²å¤§ç™½è„¸</title>

  <meta property="og:title" content="SpringMVCé¡¹ç›®ä¸­WebApplicationContextæ˜¯å¦‚ä½•æ„å»ºå‡ºæ¥çš„" />
<meta property="og:description" content="ä¸€ã€DispatcherServlet/ContextLoaderListener é—®ï¼šè¿™ä¸¤è€…æœ‰å•¥å…³è”å‘¢ï¼Ÿ ç»“è®ºï¼šè¿™ä¸¤è€…éƒ½ä¼šå»æ„å»º WebAppl" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jxsrlsl1234.github.io/blogs/springmvc%E9%A1%B9%E7%9B%AE%E4%B8%ADwebapplicationcontext%E6%98%AF%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E5%87%BA%E6%9D%A5%E7%9A%84/" /><meta property="article:section" content="blogs" />
<meta property="article:published_time" content="2022-12-22T15:50:53+08:00" />
<meta property="article:modified_time" content="2022-12-22T15:50:53+08:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SpringMVCé¡¹ç›®ä¸­WebApplicationContextæ˜¯å¦‚ä½•æ„å»ºå‡ºæ¥çš„"/>
<meta name="twitter:description" content="ä¸€ã€DispatcherServlet/ContextLoaderListener é—®ï¼šè¿™ä¸¤è€…æœ‰å•¥å…³è”å‘¢ï¼Ÿ ç»“è®ºï¼šè¿™ä¸¤è€…éƒ½ä¼šå»æ„å»º WebAppl"/>


  
  
  
  
  <link rel="stylesheet" href="https://jxsrlsl1234.github.io/assets/css/style.min.699f46622e3574a7f9ecca4c5877067845fe89ffcd9c4335df2dff23ddae215e.css" integrity="sha256-aZ9GYi41dKf57MpMWHcGeEX&#43;if/NnEM13y3/I92uIV4=">

  <script src="https://jxsrlsl1234.github.io/assets/js/main.min.182da266209851bc7c828aa7377f98f914e1e76c8decdd53a6cbe9bffea92cde.js" integrity="sha256-GC2iZiCYUbx8goqnN3&#43;Y&#43;RTh52yN7N1Tpsvpv/6pLN4="></script>
  
  </head><body><header class="header-container layout-block layout-padding">
  <div class="header-inner content-padding-large soft-size--large soft-style--box">
    <div class="header-logo">
      <a href="https://jxsrlsl1234.github.io/"><h1>éæ´²å¤§ç™½è„¸</h1></a>
    </div>
    <nav class="header-nav">
      <div class="header-nav--btn">
        <div class="btn-item"></div>
        <div class="btn-item"></div>
        <div class="btn-item"></div>
      </div>
      <div class="header-nav--list">
        <div>
          
          <a class="list-item soft-size--small soft-style--hover soft-style--active" href="/" title="">HOME</a>
          
          <a class="list-item soft-size--small soft-style--hover soft-style--active" href="/blogs" title="">BLOG</a>
          
        </div>
      </div>
    </nav>
  </div>
</header><main id="content">
    

    <div class="single-container layout-block">
      <div class="article-info">
        <div class="article-header layout-padding">
          <div class="article-cover card-container content-padding-large soft-size--large soft-style--box img">

  <div class="card-cover">
    
      <img src="https://raw.githubusercontent.com/jxsrlsl1234/public-images/master/blogs/cover1.png" alt="https://raw.githubusercontent.com/jxsrlsl1234/public-images/master/blogs/cover1.png" />
    
  </div>

  <div class="card-text">
    <h1 class="card-text--title">SpringMVCé¡¹ç›®ä¸­WebApplicationContextæ˜¯å¦‚ä½•æ„å»ºå‡ºæ¥çš„</h1>
    
      <p class="card-text--row">2022-12-22 15:50</p>
      
      
      
        <ul class="card-text--tag">
          
            <li><a href="https://jxsrlsl1234.github.io/categories/java/">Java</a></li></ul>
      

      
      
        <ul class="card-text--tag">
          
            <li><a href="https://jxsrlsl1234.github.io/tags/spring/">Spring</a></li>
            <li><a href="https://jxsrlsl1234.github.io/tags/springmvc/">SpringMVC</a></li></ul>
      
    
  </div>

</div>
        </div>

        <div class="article-content">
          <div class="markdown-body content-padding-large soft-size--large soft-style--box">
            <h2 id="ä¸€dispatcherservletcontextloaderlistener">ä¸€ã€DispatcherServlet/ContextLoaderListener</h2>
<p><strong>é—®ï¼šè¿™ä¸¤è€…æœ‰å•¥å…³è”å‘¢ï¼Ÿ</strong></p>
<p><strong>ç»“è®ºï¼šè¿™ä¸¤è€…éƒ½ä¼šå»æ„å»º WebApplicationContextã€‚å¹¶ä¸”æ„å»ºå‡ºçš„ WebApplicationContextæ˜¯ç‹¬ç«‹çš„ï¼Œä½†æœ‰çˆ¶å­å…³ç³»ã€‚</strong></p>
<p>åœ¨å¾ˆå¤šé¡¹ç›®çš„web.xmlä¸­ä¼šå‘ç°é…ç½®äº†è¿™ä¸¤è€…</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span style="color:#f92672">&lt;web-app</span> <span style="color:#a6e22e">version=</span><span style="color:#e6db74">&#34;3.0&#34;</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;http://java.sun.com/xml/ns/javaee&#34;</span>
    <span style="color:#a6e22e">xmlns:xsi=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
    <span style="color:#a6e22e">xsi:schemaLocation=</span><span style="color:#e6db74">&#34;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&#34;</span><span style="color:#f92672">&gt;</span>
    
     <span style="color:#75715e">&lt;!-- ç›‘å¬å™¨é…ç½® --&gt;</span>
    <span style="color:#f92672">&lt;listener&gt;</span>
    	<span style="color:#f92672">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span style="color:#f92672">&lt;/listener-class&gt;</span>
    <span style="color:#f92672">&lt;/listener&gt;</span>
    
    <span style="color:#75715e">&lt;!-- ä¸Šä¸‹æ–‡å‚æ•°ï¼Œåœ¨ç›‘å¬å™¨ä¸­è¢«ä½¿ç”¨ --&gt;</span>
    <span style="color:#75715e">&lt;!-- ç›‘å¬å™¨é…ç½®æ–‡ä»¶è·¯å¾„ --&gt;</span>
    <span style="color:#f92672">&lt;context-param&gt;</span>
    	<span style="color:#f92672">&lt;param-name&gt;</span>contextConfigLocation<span style="color:#f92672">&lt;/param-name&gt;</span>
    	<span style="color:#f92672">&lt;param-value&gt;</span>
        	classpath:applicationContext.xml
        <span style="color:#f92672">&lt;/param-value&gt;</span>
    <span style="color:#f92672">&lt;/context-param&gt;</span>
    
    <span style="color:#75715e">&lt;!-- å‰ç«¯æ§åˆ¶å™¨é…ç½® --&gt;</span>
    <span style="color:#f92672">&lt;servlet&gt;</span>
        <span style="color:#75715e">&lt;!--åœ¨DispatcherServletçš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œæ¡†æ¶ä¼šåœ¨webåº”ç”¨çš„WEB-INFæ–‡ä»¶å¤¹ä¸‹é»˜è®¤å¯»æ‰¾åä¸º[servlet-name]-servlet.xml çš„é…ç½®æ–‡ä»¶ï¼Œç”Ÿæˆæ–‡ä»¶ä¸­å®šä¹‰çš„beanã€‚å¦‚ä»¥ä¸‹é»˜è®¤å¯»æ‰¾api-servlet.xml--&gt;</span>
    	<span style="color:#f92672">&lt;servlet-name&gt;</span>api<span style="color:#f92672">&lt;/servlet-name&gt;</span>
    	<span style="color:#f92672">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span style="color:#f92672">&lt;/servlet-class&gt;</span>
    	<span style="color:#f92672">&lt;init-param&gt;</span>
            <span style="color:#75715e">&lt;!-- å‰ç«¯æ§åˆ¶å™¨é…ç½®æ–‡ä»¶è·¯å¾„ --&gt;</span>
    		<span style="color:#f92672">&lt;param-name&gt;</span>contextConfigLocation<span style="color:#f92672">&lt;/param-name&gt;</span>
    		<span style="color:#f92672">&lt;param-value&gt;</span>classpath:applicationContext-mvc.xml<span style="color:#f92672">&lt;/param-value&gt;</span>
    	<span style="color:#f92672">&lt;/init-param&gt;</span>
        <span style="color:#75715e">&lt;!--æ˜¯å¯åŠ¨é¡ºåºï¼Œè®©è¿™ä¸ªServletéšServletpå®¹å™¨ä¸€èµ·å¯åŠ¨ã€‚--&gt;</span>
    	<span style="color:#f92672">&lt;load-on-startup&gt;</span>1<span style="color:#f92672">&lt;/load-on-startup&gt;</span>
    <span style="color:#f92672">&lt;/servlet&gt;</span>
    
    <span style="color:#f92672">&lt;servlet-mapping&gt;</span>
        <span style="color:#75715e">&lt;!--è¿™ä¸ªServletçš„åå­—æ˜¯apiï¼Œå¯ä»¥æœ‰å¤šä¸ªDispatcherServletï¼Œæ˜¯é€šè¿‡åå­—æ¥åŒºåˆ†çš„ã€‚æ¯ä¸€ä¸ªDispatcherServletæœ‰è‡ªå·±çš„WebApplicationContextä¸Šä¸‹æ–‡å¯¹è±¡ã€‚åŒæ—¶ä¿å­˜çš„ServletContextä¸­å’ŒRequestå¯¹è±¡ä¸­.--&gt;</span>
        <span style="color:#75715e">&lt;!--ApplicationContextæ˜¯Springçš„æ ¸å¿ƒï¼ŒContextæˆ‘ä»¬é€šå¸¸è§£é‡Šä¸ºä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œæˆ‘æƒ³ç”¨â€œå®¹å™¨â€æ¥è¡¨è¿°å®ƒæ›´å®¹æ˜“ç†è§£ä¸€äº›ï¼ŒApplicationContextåˆ™æ˜¯â€œåº”ç”¨çš„å®¹å™¨â€äº†:Pï¼ŒSpringæŠŠBeanæ”¾åœ¨è¿™ä¸ªå®¹å™¨ä¸­ï¼Œåœ¨éœ€è¦çš„æ—¶å€™ï¼Œç”¨getBeanæ–¹æ³•å–å‡º--&gt;</span>
    	<span style="color:#f92672">&lt;servlet-name&gt;</span>api<span style="color:#f92672">&lt;/servlet-name&gt;</span>
        <span style="color:#75715e">&lt;!--Servletæ‹¦æˆªåŒ¹é…è§„åˆ™å¯ä»¥è‡ªå·²å®šä¹‰ï¼Œå½“æ˜ å°„ä¸º@RequestMapping(&#34;/user/add&#34;)æ—¶ï¼Œä¸ºä¾‹,æ‹¦æˆªå“ªç§URLåˆé€‚ï¼Ÿ--&gt;</span>
        <span style="color:#75715e">&lt;!--1ã€æ‹¦æˆª*.doã€*.htmï¼Œ ä¾‹å¦‚ï¼š/user/add.do,è¿™æ˜¯æœ€ä¼ ç»Ÿçš„æ–¹å¼ï¼Œæœ€ç®€å•ä¹Ÿæœ€å®ç”¨ã€‚ä¸ä¼šå¯¼è‡´é™æ€æ–‡ä»¶ï¼ˆjpg,js,cssï¼‰è¢«æ‹¦æˆªã€‚--&gt;</span>
        <span style="color:#75715e">&lt;!--2ã€æ‹¦æˆª/ï¼Œä¾‹å¦‚ï¼š/user/add,å¯ä»¥å®ç°ç°åœ¨å¾ˆæµè¡Œçš„RESTé£æ ¼ã€‚å¾ˆå¤šäº’è”ç½‘ç±»å‹çš„åº”ç”¨å¾ˆå–œæ¬¢è¿™ç§é£æ ¼çš„URLã€‚å¼Šç«¯ï¼šä¼šå¯¼è‡´é™æ€æ–‡ä»¶ï¼ˆjpg,js,cssï¼‰è¢«æ‹¦æˆªåä¸èƒ½æ­£å¸¸æ˜¾ç¤ºã€‚ --&gt;</span>
    	<span style="color:#f92672">&lt;url-pattern&gt;</span>/<span style="color:#f92672">&lt;/url-pattern&gt;</span>
    <span style="color:#f92672">&lt;/servlet-mapping&gt;</span>

<span style="color:#f92672">&lt;/web-app&gt;</span>
</code></pre></div><p>æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æš‚ä¸”æŠŠDispacherServletå†…éƒ¨æ„å»ºå‡ºæ¥çš„WebApplicationContextç§°ä¸º<strong>mvcWebApplicationContext</strong>;</p>
<p>æŠŠContextLoaderListener æ„å»ºå‡ºæ¥çš„WebApplicationContextç§°ä¸º<strong>RootWebApplicationContext</strong>;</p>
<h3 id="11-contextloaderlistener">1.1 ContextLoaderListener</h3>
<p>ContextLoaderListenerç›´æ¥å®ç°äº†javax.servlet.ServletContextListeneræ¥å£ï¼Œå› æ­¤ç›´æ¥åœ¨é‡å†™çš„æ–¹æ³•org.springframework.web.context.ContextLoaderListener#contextInitialized ä¸­è°ƒç”¨ContextLoaderï¼Œè¿›è¡Œåˆå§‹åŒ–webApplicationContext</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">	 * Initialize the root web application context.
</span><span style="color:#75715e">	 */</span>
	<span style="color:#a6e22e">@Override</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">contextInitialized</span><span style="color:#f92672">(</span>ServletContextEvent event<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		initWebApplicationContext<span style="color:#f92672">(</span>event<span style="color:#f92672">.</span><span style="color:#a6e22e">getServletContext</span><span style="color:#f92672">());</span>
	<span style="color:#f92672">}</span>
</code></pre></div><p>å…¶ä¸­æºç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> WebApplicationContext <span style="color:#a6e22e">initWebApplicationContext</span><span style="color:#f92672">(</span>ServletContext servletContext<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  <span style="color:#75715e">// contextLoaderå…ˆä»servletContextå±æ€§ä¸­æ‰¾RootWebApplicationContextï¼Œä¸€å®šä¸èƒ½å­˜åœ¨ï¼Œ
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// å­˜åœ¨è¯´æ˜å·²ç»æœ‰ä¸€ä¸ªRootWebApplicationContext,å·²ç»åˆå§‹åŒ–è¿‡ä¸€ä¸ªäº†
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>servletContext<span style="color:#f92672">.</span><span style="color:#a6e22e">getAttribute</span><span style="color:#f92672">(</span>WebApplicationContext<span style="color:#f92672">.</span><span style="color:#a6e22e">ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE</span><span style="color:#f92672">)</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			<span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalStateException<span style="color:#f92672">(</span>
					<span style="color:#e6db74">&#34;Cannot initialize context because there is already a root application context present - &#34;</span> <span style="color:#f92672">+</span>
					<span style="color:#e6db74">&#34;check whether you have multiple ContextLoader* definitions in your web.xml!&#34;</span><span style="color:#f92672">);</span>
		<span style="color:#f92672">}</span>

		servletContext<span style="color:#f92672">.</span><span style="color:#a6e22e">log</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Initializing Spring root WebApplicationContext&#34;</span><span style="color:#f92672">);</span>
		Log logger <span style="color:#f92672">=</span> LogFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getLog</span><span style="color:#f92672">(</span>ContextLoader<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
		<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>logger<span style="color:#f92672">.</span><span style="color:#a6e22e">isInfoEnabled</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
			logger<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Root WebApplicationContext: initialization started&#34;</span><span style="color:#f92672">);</span>
		<span style="color:#f92672">}</span>
		<span style="color:#66d9ef">long</span> startTime <span style="color:#f92672">=</span> System<span style="color:#f92672">.</span><span style="color:#a6e22e">currentTimeMillis</span><span style="color:#f92672">();</span>

		<span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
			<span style="color:#75715e">// Store context in local instance variable, to guarantee that
</span><span style="color:#75715e"></span>			<span style="color:#75715e">// it is available on ServletContext shutdown.
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// ContextLoaderå¯¹è±¡ä¸­å­˜å‚¨RootWebApplicationContextçš„å˜é‡
</span><span style="color:#75715e"></span>			<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">context</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// ç›´æ¥åˆ›å»ºä¸€ä¸ªRootWebApplicationContext
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// åˆ›å»ºçš„æ–¹å¼å°±æ˜¯é€šè¿‡è¯»å–æŸäº›æ–¹å¼æŒ‡å®šï¼ˆservletå±æ€§å¯¹ä¸­çš„contextClassæˆ–è€…ContextLoader.propertiesæ–‡ä»¶ä¸­æŒ‡å®šçš„classï¼‰çš„ContextClassï¼Œ
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// ç„¶åé€šè¿‡åå°„çš„æ–¹å¼å»å®ä¾‹åŒ–è¿™ä¸ªcontextClassçš„å¯¹è±¡
</span><span style="color:#75715e"></span>				<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">context</span> <span style="color:#f92672">=</span> createWebApplicationContext<span style="color:#f92672">(</span>servletContext<span style="color:#f92672">);</span>
			<span style="color:#f92672">}</span>
			<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">context</span> <span style="color:#66d9ef">instanceof</span> ConfigurableWebApplicationContext<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
				ConfigurableWebApplicationContext cwac <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>ConfigurableWebApplicationContext<span style="color:#f92672">)</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">context</span><span style="color:#f92672">;</span>
        <span style="color:#75715e">// æ²¡æœ‰refreshçš„è¯è¿›å…¥if
</span><span style="color:#75715e"></span>				<span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>cwac<span style="color:#f92672">.</span><span style="color:#a6e22e">isActive</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
					<span style="color:#75715e">// The context has not yet been refreshed -&gt; provide services such as
</span><span style="color:#75715e"></span>					<span style="color:#75715e">// setting the parent context, setting the application context id, etc
</span><span style="color:#75715e"></span>					<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>cwac<span style="color:#f92672">.</span><span style="color:#a6e22e">getParent</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
						<span style="color:#75715e">// The context instance was injected without an explicit parent -&gt;
</span><span style="color:#75715e"></span>						<span style="color:#75715e">// determine parent for root web application context, if any.
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// è¿™é‡Œparentå…¶å®å°±æ˜¯nullï¼ŒRootWebApplicationContextçš„parentå°±æ˜¯null
</span><span style="color:#75715e"></span>						ApplicationContext parent <span style="color:#f92672">=</span> loadParentContext<span style="color:#f92672">(</span>servletContext<span style="color:#f92672">);</span>
						cwac<span style="color:#f92672">.</span><span style="color:#a6e22e">setParent</span><span style="color:#f92672">(</span>parent<span style="color:#f92672">);</span>
					<span style="color:#f92672">}</span>
          <span style="color:#75715e">// æ„‰å¿«åœ°refreshäº†
</span><span style="color:#75715e"></span>					configureAndRefreshWebApplicationContext<span style="color:#f92672">(</span>cwac<span style="color:#f92672">,</span> servletContext<span style="color:#f92672">);</span>
				<span style="color:#f92672">}</span>
			<span style="color:#f92672">}</span>
      <span style="color:#75715e">// æŠŠè¿™ä¸ªRootWebApplicationContextè®¾ç½®åˆ°ServletContextçš„org.springframework.web.context.WebApplicationContext.ROOTå±æ€§é‡Œ
</span><span style="color:#75715e"></span>			servletContext<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span>WebApplicationContext<span style="color:#f92672">.</span><span style="color:#a6e22e">ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">context</span><span style="color:#f92672">);</span>

			ClassLoader ccl <span style="color:#f92672">=</span> Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">currentThread</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getContextClassLoader</span><span style="color:#f92672">();</span>
			<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ccl <span style="color:#f92672">==</span> ContextLoader<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClassLoader</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
				currentContext <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">context</span><span style="color:#f92672">;</span>
			<span style="color:#f92672">}</span>
			<span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ccl <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">//  ä¿å­˜classloaderå’ŒRootWebApplicationContextçš„æ˜ å°„å…³ç³»
</span><span style="color:#75715e"></span>				currentContextPerThread<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>ccl<span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">context</span><span style="color:#f92672">);</span>
			<span style="color:#f92672">}</span>

			<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>logger<span style="color:#f92672">.</span><span style="color:#a6e22e">isInfoEnabled</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
				<span style="color:#66d9ef">long</span> elapsedTime <span style="color:#f92672">=</span> System<span style="color:#f92672">.</span><span style="color:#a6e22e">currentTimeMillis</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> startTime<span style="color:#f92672">;</span>
				logger<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Root WebApplicationContext initialized in &#34;</span> <span style="color:#f92672">+</span> elapsedTime <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; ms&#34;</span><span style="color:#f92672">);</span>
			<span style="color:#f92672">}</span>

			<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">context</span><span style="color:#f92672">;</span>
		<span style="color:#f92672">}</span>
		<span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>RuntimeException <span style="color:#f92672">|</span> Error ex<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			logger<span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Context initialization failed&#34;</span><span style="color:#f92672">,</span> ex<span style="color:#f92672">);</span>
      <span style="color:#75715e">// å¤±è´¥çš„è¯å±æ€§å€¼è®¾ç½®ä¸ºå¼‚å¸¸å¯¹è±¡
</span><span style="color:#75715e"></span>			servletContext<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span>WebApplicationContext<span style="color:#f92672">.</span><span style="color:#a6e22e">ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE</span><span style="color:#f92672">,</span> ex<span style="color:#f92672">);</span>
			<span style="color:#66d9ef">throw</span> ex<span style="color:#f92672">;</span>
		<span style="color:#f92672">}</span>
	<span style="color:#f92672">}</span>

<span style="color:#75715e">//è‡³æ­¤ï¼ŒContextLoaderä¸­çš„WebApplicationContextï¼ˆRootWebWebApplicationContextï¼‰å°±æ„å»ºå‡ºæ¥äº†ã€‚
</span></code></pre></div><h3 id="12-dispacherservlet">1.2 DispacherServlet</h3>
<p>æ•´ä¸ªç»§æ‰¿é“¾è·¯è¿™ä¹ˆçœ‹ï¼š</p>
<p>
  <p><img src="https://raw.githubusercontent.com/jxsrlsl1234/public-images/master/blogs/DispatcherServlet%E7%BB%A7%E6%89%BF.jpg" alt="" loading="lazy" /></p>
</p>
<p>DispacherServletæ˜¯é›†æˆäº†FrameworkServletçš„åˆå§‹åŒ–WebApplicationContextçš„æ–¹æ³•çš„ã€‚</p>
<p>æºç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> WebApplicationContext <span style="color:#a6e22e">initWebApplicationContext</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
  <span style="color:#75715e">//å…ˆå»ServletContextçš„è¿™ä¸ªå±æ€§ï¼ˆorg.springframework.web.context.WebApplicationContext.ROOTï¼‰é‡Œæ‰¾æœ‰æ²¡æœ‰å¯¹åº”çš„RootWebApplicationContext
</span><span style="color:#75715e"></span>		WebApplicationContext rootContext <span style="color:#f92672">=</span>
				WebApplicationContextUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getWebApplicationContext</span><span style="color:#f92672">(</span>getServletContext<span style="color:#f92672">());</span>
		WebApplicationContext wac <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
		<span style="color:#75715e">// é¦–æ¬¡è¿›æ¥ä¸€èˆ¬DispacherServleté‡ŒwebApplicationContextå˜é‡éƒ½æ˜¯nullçš„ï¼Œå› ä¸ºnullä½ æ‰éœ€è¦åˆ›å»ºå˜›ï¼Œ
</span><span style="color:#75715e"></span>   <span style="color:#75715e">//å½“ç„¶ä¹Ÿä¸æ’é™¤æ„å»ºDispacherServletçš„æ˜¯æ—¶å€™é€šè¿‡æ„é€ å‡½æ•°ï¼Œå¡äº†ä¸€ä¸ªwebApplicationContextå¯¹è±¡è¿›æ¥
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">webApplicationContext</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			<span style="color:#75715e">// å¦‚æœæ˜¯æ„é€ å‡½æ•°ç›´æ¥å¡è¿›æ¥çš„ï¼Œç›´æ¥èµ‹å€¼
</span><span style="color:#75715e"></span>			wac <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">webApplicationContext</span><span style="color:#f92672">;</span>
			<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>wac <span style="color:#66d9ef">instanceof</span> ConfigurableWebApplicationContext<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
				ConfigurableWebApplicationContext cwac <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>ConfigurableWebApplicationContext<span style="color:#f92672">)</span> wac<span style="color:#f92672">;</span>
        <span style="color:#75715e">// å¦‚æœåœ¨è¿™ä¸ªmvcWebApplicationContextæ²¡æœ‰refreshè¿‡çš„è¯
</span><span style="color:#75715e"></span>				<span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>cwac<span style="color:#f92672">.</span><span style="color:#a6e22e">isActive</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
					<span style="color:#75715e">// The context has not yet been refreshed -&gt; provide services such as
</span><span style="color:#75715e"></span>					<span style="color:#75715e">// setting the parent context, setting the application context id, etc
</span><span style="color:#75715e"></span>					<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>cwac<span style="color:#f92672">.</span><span style="color:#a6e22e">getParent</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
						<span style="color:#75715e">// The context instance was injected without an explicit parent -&gt; set
</span><span style="color:#75715e"></span>						<span style="color:#75715e">// the root application context (if any; may be null) as the parent
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// å¦‚æœè¿™ä¸ªmvcWebApplicationContextæ²¡æœ‰è®¾ç½®è¿‡parentï¼Œå°±æŠŠå‰é¢æ‹¿åˆ°çš„RootWebApplicationContext è®¾ç½®ä¸ºå®ƒçš„parent
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// æ³¨æ„ï¼šå­contextæ˜¯å¯ä»¥æ³¨å…¥parentContextä¸­çš„Beançš„ï¼Œç›¸åä¸å¯ä»¥
</span><span style="color:#75715e"></span>						cwac<span style="color:#f92672">.</span><span style="color:#a6e22e">setParent</span><span style="color:#f92672">(</span>rootContext<span style="color:#f92672">);</span>
					<span style="color:#f92672">}</span>
          <span style="color:#75715e">// æ²¡æœ‰refreshï¼Œå°±refreshä¸€æ¬¡
</span><span style="color:#75715e"></span>					configureAndRefreshWebApplicationContext<span style="color:#f92672">(</span>cwac<span style="color:#f92672">);</span>
				<span style="color:#f92672">}</span>
			<span style="color:#f92672">}</span>
		<span style="color:#f92672">}</span>
		<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>wac <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			<span style="color:#75715e">// No context instance was injected at construction time -&gt; see if one
</span><span style="color:#75715e"></span>			<span style="color:#75715e">// has been registered in the servlet context. If one exists, it is assumed
</span><span style="color:#75715e"></span>			<span style="color:#75715e">// that the parent context (if any) has already been set and that the
</span><span style="color:#75715e"></span>			<span style="color:#75715e">// user has performed any initialization such as setting the context id
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// æ„é€ å‡½æ•°æ²¡æœ‰æ³¨å…¥çš„è¯ï¼Œå°±ä»ServletCOntextæŒ‡å®šçš„å±æ€§é‡Œå»è·å–mvcWebApplicationContext
</span><span style="color:#75715e"></span>			wac <span style="color:#f92672">=</span> findWebApplicationContext<span style="color:#f92672">();</span>
		<span style="color:#f92672">}</span>
		<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>wac <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			<span style="color:#75715e">// No context instance is defined for this servlet -&gt; create a local one
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// å¦‚æœä»¥ä¸Šæ­¥éª¤éƒ½å‘ç°servletContextä¸­æ²¡æœ‰ï¼Œé‚£åªèƒ½è‡ªå·±åˆ›å»ºä¸€ä¸ªäº†
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// å†…éƒ¨å¯ä»¥åˆ›å»ºæŒ‡å®šç±»å‹çš„ConfigurableWebApplicationContextï¼Œç„¶årefresh
</span><span style="color:#75715e"></span>			wac <span style="color:#f92672">=</span> createWebApplicationContext<span style="color:#f92672">(</span>rootContext<span style="color:#f92672">);</span>
		<span style="color:#f92672">}</span>

		<span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">refreshEventReceived</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			<span style="color:#75715e">// Either the context is not a ConfigurableApplicationContext with refresh
</span><span style="color:#75715e"></span>			<span style="color:#75715e">// support or the context injected at construction time had already been
</span><span style="color:#75715e"></span>			<span style="color:#75715e">// refreshed -&gt; trigger initial onRefresh manually here.
</span><span style="color:#75715e"></span>			<span style="color:#66d9ef">synchronized</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">onRefreshMonitor</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
				onRefresh<span style="color:#f92672">(</span>wac<span style="color:#f92672">);</span>
			<span style="color:#f92672">}</span>
		<span style="color:#f92672">}</span>

		<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">publishContext</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			<span style="color:#75715e">// Publish the context as a servlet context attribute.
</span><span style="color:#75715e"></span>			String attrName <span style="color:#f92672">=</span> getServletContextAttributeName<span style="color:#f92672">();</span>
      <span style="color:#75715e">// å°†è¿™ä¸ªmvcWebApplicationContextä¿å­˜åœ¨servletContextçš„å±æ€§å¯¹é‡Œï¼Œ
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// keyä¸ºorg.springframework.web.servlet.FrameworkServlet.CONTEXT.[servletName]
</span><span style="color:#75715e"></span>			getServletContext<span style="color:#f92672">().</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span>attrName<span style="color:#f92672">,</span> wac<span style="color:#f92672">);</span>
		<span style="color:#f92672">}</span>

		<span style="color:#66d9ef">return</span> wac<span style="color:#f92672">;</span>
	<span style="color:#f92672">}</span>
<span style="color:#75715e">// è‡³æ­¤ï¼ŒDispacherServletä¸­çš„WebApplicationContextï¼ˆwebWebApplicationContextï¼‰å°±æ„å»ºå‡ºæ¥äº†ã€‚
</span></code></pre></div><h3 id="13-ç»“è®º">1.3 ç»“è®º</h3>
<p>ä»ä»¥ä¸Šä¸¤æ®µåˆ†æå‘ç°ï¼ŒContextLoader åˆ›å»ºå‡ºæ¥çš„ RootWebApplicationContext ä¼šè¢«å­˜æ”¾åœ¨ ServletContext çš„ <code>org.springframework.web.context.WebApplicationContext.ROOT</code> å±æ€§é‡Œï¼›åç»­ DispacherServlet å»æ„å»ºmvcWebApplicationContext çš„æ—¶å€™ï¼Œä¼šå» servletContext é‡Œå»<code>org.springframework.web.context.WebApplicationContext.ROOT</code>å±æ€§å¯¹åº”å€¼çš„ RootWebApplicationContext å¯¹è±¡ä½œä¸º mvcWebApplicationContext çš„ parentã€‚æ‰€ä»¥çˆ¶å­å…³ç³»å¦‚ä¸‹ï¼š</p>
<p>
  <p><img src="https://raw.githubusercontent.com/jxsrlsl1234/public-images/master/blogs/20221222152451.png" alt="" loading="lazy" /></p>
</p>
<h2 id="äºŒwebapplicationinitializerspringservletcontainerinitializer">äºŒã€WebApplicationInitializer/SpringServletContainerInitializer</h2>
<h3 id="21-webapplicationinitializer">2.1 WebApplicationInitializer</h3>
<p>WebApplicationInitializer æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ˜¯åŸºäºServlet 3.0å®ç°çš„æ ‡å‡†ï¼Œå…¶å®è¿™ä¸ªæ¥å£å®ç°ç±»çš„ç›®çš„éƒ½æ˜¯æ›¿ä»£web.xmlï¼Œä»¥ç¼–ç¨‹å¼çš„æ–¹å¼æ›¿ä»£web.xmlå¯¹ServletContextçš„é…ç½®ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">WebApplicationInitializer</span> <span style="color:#f92672">{</span>

	<span style="color:#75715e">/**
</span><span style="color:#75715e">	 * Configure the given {@link ServletContext} with any servlets, filters, listeners
</span><span style="color:#75715e">	 * context-params and attributes necessary for initializing this web application. See
</span><span style="color:#75715e">	 * examples {@linkplain WebApplicationInitializer above}.
</span><span style="color:#75715e">	 * @param servletContext the {@code ServletContext} to initialize
</span><span style="color:#75715e">	 * @throws ServletException if any call against the given {@code ServletContext}
</span><span style="color:#75715e">	 * throws a {@code ServletException}
</span><span style="color:#75715e">	 */</span>
	<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onStartup</span><span style="color:#f92672">(</span>ServletContext servletContext<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">;</span>
</code></pre></div><p>è¿™ä¸ªæ¥å£æœ€é‡è¦çš„ä¸€ä¸ªå®ç°ç±»æ˜¯ <code>org.springframework.web.servlet.support.AbstractDispatcherServletInitializer</code></p>
<p><strong>å¯ä»¥æŒ‰ä¸€ä¸‹é“¾è·¯çœ‹ï¼š</strong></p>
<p>
  <p><img src="https://raw.githubusercontent.com/jxsrlsl1234/public-images/master/blogs/202212221529395.png" alt="" loading="lazy" /></p>
</p>
<p>å…·ä½“è¿™ä¸ªæ–¹æ³•ä»£ç å¦‚ä¸‹ï¼š</p>
<p><strong>org.springframework.web.context.AbstractContextLoaderInitializer#onStartup</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Override</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onStartup</span><span style="color:#f92672">(</span>ServletContext servletContext<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException <span style="color:#f92672">{</span>
    <span style="color:#75715e">// ä»£æ›¿web.xmlæ–‡ä»¶ï¼Œç›´æ¥æ³¨å†Œä¸€ä¸ªContextLoaderListener
</span><span style="color:#75715e"></span>		registerContextLoaderListener<span style="color:#f92672">(</span>servletContext<span style="color:#f92672">);</span>
	<span style="color:#f92672">}</span>

	<span style="color:#75715e">/**
</span><span style="color:#75715e">	 * Register a {@link ContextLoaderListener} against the given servlet context. The
</span><span style="color:#75715e">	 * {@code ContextLoaderListener} is initialized with the application context returned
</span><span style="color:#75715e">	 * from the {@link #createRootApplicationContext()} template method.
</span><span style="color:#75715e">	 * @param servletContext the servlet context to register the listener against
</span><span style="color:#75715e">	 */</span>
	<span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">registerContextLoaderListener</span><span style="color:#f92672">(</span>ServletContext servletContext<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// å…ˆåˆ›å»ºRootWebApplicationContext
</span><span style="color:#75715e"></span>		WebApplicationContext rootAppContext <span style="color:#f92672">=</span> createRootApplicationContext<span style="color:#f92672">();</span>
		<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>rootAppContext <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			ContextLoaderListener listener <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ContextLoaderListener<span style="color:#f92672">(</span>rootAppContext<span style="color:#f92672">);</span>
			listener<span style="color:#f92672">.</span><span style="color:#a6e22e">setContextInitializers</span><span style="color:#f92672">(</span>getRootApplicationContextInitializers<span style="color:#f92672">());</span>
			servletContext<span style="color:#f92672">.</span><span style="color:#a6e22e">addListener</span><span style="color:#f92672">(</span>listener<span style="color:#f92672">);</span>
		<span style="color:#f92672">}</span>
		<span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
			logger<span style="color:#f92672">.</span><span style="color:#a6e22e">debug</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;No ContextLoaderListener registered, as &#34;</span> <span style="color:#f92672">+</span>
					<span style="color:#e6db74">&#34;createRootApplicationContext() did not return an application context&#34;</span><span style="color:#f92672">);</span>
		<span style="color:#f92672">}</span>
	<span style="color:#f92672">}</span>
</code></pre></div><p><strong>org.springframework.web.servlet.support.AbstractDispatcherServletInitializer#onStartup</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Override</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onStartup</span><span style="color:#f92672">(</span>ServletContext servletContext<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException <span style="color:#f92672">{</span>
    <span style="color:#75715e">// çˆ¶ç±»çš„ç›®çš„æ˜¯æ³¨å†Œä¸€ä¸ªContextLoaderListener
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">onStartup</span><span style="color:#f92672">(</span>servletContext<span style="color:#f92672">);</span>
    <span style="color:#75715e">// è‡ªå·±å®ç°æ˜¯æ³¨å†Œä¸€ä¸ªDispacherServlet
</span><span style="color:#75715e"></span>		registerDispatcherServlet<span style="color:#f92672">(</span>servletContext<span style="color:#f92672">);</span>
	<span style="color:#f92672">}</span>

	<span style="color:#75715e">/**
</span><span style="color:#75715e">	 * Register a {@link DispatcherServlet} against the given servlet context.
</span><span style="color:#75715e">	 * &lt;p&gt;This method will create a {@code DispatcherServlet} with the name returned by
</span><span style="color:#75715e">	 * {@link #getServletName()}, initializing it with the application context returned
</span><span style="color:#75715e">	 * from {@link #createServletApplicationContext()}, and mapping it to the patterns
</span><span style="color:#75715e">	 * returned from {@link #getServletMappings()}.
</span><span style="color:#75715e">	 * &lt;p&gt;Further customization can be achieved by overriding {@link
</span><span style="color:#75715e">	 * #customizeRegistration(ServletRegistration.Dynamic)} or
</span><span style="color:#75715e">	 * {@link #createDispatcherServlet(WebApplicationContext)}.
</span><span style="color:#75715e">	 * @param servletContext the context to register the servlet against
</span><span style="color:#75715e">	 */</span>
	<span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">registerDispatcherServlet</span><span style="color:#f92672">(</span>ServletContext servletContext<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		String servletName <span style="color:#f92672">=</span> getServletName<span style="color:#f92672">();</span>
		Assert<span style="color:#f92672">.</span><span style="color:#a6e22e">hasLength</span><span style="color:#f92672">(</span>servletName<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;getServletName() must not return null or empty&#34;</span><span style="color:#f92672">);</span>

		WebApplicationContext servletAppContext <span style="color:#f92672">=</span> createServletApplicationContext<span style="color:#f92672">();</span>
		Assert<span style="color:#f92672">.</span><span style="color:#a6e22e">notNull</span><span style="color:#f92672">(</span>servletAppContext<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;createServletApplicationContext() must not return null&#34;</span><span style="color:#f92672">);</span>

    <span style="color:#75715e">// ç›´æ¥åˆ›å»ºä¸€ä¸ªDispacherServlet
</span><span style="color:#75715e"></span>		FrameworkServlet dispatcherServlet <span style="color:#f92672">=</span> createDispatcherServlet<span style="color:#f92672">(</span>servletAppContext<span style="color:#f92672">);</span>
		Assert<span style="color:#f92672">.</span><span style="color:#a6e22e">notNull</span><span style="color:#f92672">(</span>dispatcherServlet<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;createDispatcherServlet(WebApplicationContext) must not return null&#34;</span><span style="color:#f92672">);</span>
		dispatcherServlet<span style="color:#f92672">.</span><span style="color:#a6e22e">setContextInitializers</span><span style="color:#f92672">(</span>getServletApplicationContextInitializers<span style="color:#f92672">());</span>

		ServletRegistration<span style="color:#f92672">.</span><span style="color:#a6e22e">Dynamic</span> registration <span style="color:#f92672">=</span> servletContext<span style="color:#f92672">.</span><span style="color:#a6e22e">addServlet</span><span style="color:#f92672">(</span>servletName<span style="color:#f92672">,</span> dispatcherServlet<span style="color:#f92672">);</span>
		<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>registration <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			<span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalStateException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Failed to register servlet with name &#39;&#34;</span> <span style="color:#f92672">+</span> servletName <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&#39;. &#34;</span> <span style="color:#f92672">+</span>
					<span style="color:#e6db74">&#34;Check if there is another servlet registered under the same name.&#34;</span><span style="color:#f92672">);</span>
		<span style="color:#f92672">}</span>

		registration<span style="color:#f92672">.</span><span style="color:#a6e22e">setLoadOnStartup</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
		registration<span style="color:#f92672">.</span><span style="color:#a6e22e">addMapping</span><span style="color:#f92672">(</span>getServletMappings<span style="color:#f92672">());</span>
		registration<span style="color:#f92672">.</span><span style="color:#a6e22e">setAsyncSupported</span><span style="color:#f92672">(</span>isAsyncSupported<span style="color:#f92672">());</span>

		Filter<span style="color:#f92672">[]</span> filters <span style="color:#f92672">=</span> getServletFilters<span style="color:#f92672">();</span>
		<span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>ObjectUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">(</span>filters<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
			<span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Filter filter <span style="color:#f92672">:</span> filters<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
				registerServletFilter<span style="color:#f92672">(</span>servletContext<span style="color:#f92672">,</span> filter<span style="color:#f92672">);</span>
			<span style="color:#f92672">}</span>
		<span style="color:#f92672">}</span>

		customizeRegistration<span style="color:#f92672">(</span>registration<span style="color:#f92672">);</span>
	<span style="color:#f92672">}</span>
</code></pre></div><p>ä»ä¸Šé¢è¿™ä¸ªç±»å‘ä¸‹ï¼Œè¿™ä¸ªç±»å®Œæˆäº†webx.xmlçš„ä¸»è¦åŠŸèƒ½ï¼Œå°±æ˜¯æ³¨å†Œäº† <strong>RootWebApplicationContext</strong> å’Œ <strong>DispacherServlet</strong>ã€‚</p>
<h3 id="22-springservletcontainerinitializer">2.2 SpringServletContainerInitializer</h3>
<p>é—®é¢˜æ¥äº†ï¼Œ2.1ä¸­çš„WebApplicationInitializeræ˜¯å¦‚ä½•è¢«è§¦å‘çš„å‘¢ï¼Ÿ</p>
<p>è¿™ä¹Ÿæ˜¯æœ¬èŠ‚ä»‹ç»çš„SpringServletContainerInitializerçš„ä½œç”¨ã€‚</p>
<p>SpringServletContainerInitializer æ˜¯ ServletContainerInitializer çš„ä¸€ä¸ªå®ç°ï¼Œè€Œ ServletContainerInitializer æ˜¯Servlet 3.0æå‡ºçš„æ–°æ¥å£ï¼Œæ¥å£æ³¨é‡Šä¸Šå†™æ˜äº†è¯¥æ¥å£æ˜¯ä¸ºäº†åœ¨webæœåŠ¡å¯åŠ¨é˜¶æ®µå»ç¼–ç¨‹å¼åœ°æ³¨å†Œservletã€filterã€listenerã€‚å¦å¤–è¿™ä¸ªæ¥å£çš„å®ç°å¯ä»¥ç»‘å®š <code>{@link javax.servlet.annotation.HandlesTypes HandlesTypes}</code> æ³¨è§£ï¼Œç»‘å®šåï¼Œå¯åŠ¨è¿‡ç¨‹ä¼šå°†æ”¹æ³¨è§£æŒ‡å®šçš„ç±»å‹çš„å®ç°ç”Ÿæˆä¸€ä¸ªSetï¼Œä¼ å…¥onStartupæ–¹æ³•ã€‚æ”¹æ¥å£çš„å®ç°æ˜¯é‡‡ç”¨Spiæ–¹å¼è¯»å–ï¼Œæ‰€ä»¥ <code>org.springframework.web.SpringServletContainerInitializer</code> è¿™ä¸ªç±»åœ¨spring-webåŒ…å†…æ˜¯æ˜ç¡®æŒ‡å®šäº†å®ç°çš„</p>
<p>
  <p><img src="https://raw.githubusercontent.com/jxsrlsl1234/public-images/master/blogs/SpringServletContainerInitializer.png" alt="" loading="lazy" /></p>
</p>
<p>åŒæ—¶ï¼Œå¯ä»¥å‘ç° <strong>SpringServletContainerInitializer</strong> æ˜¯ ç»‘å®šäº†ä¸€ç»„ <strong>WebApplicationInitializer</strong> å®ç°çš„ã€‚å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// HandlesTypesæ³¨è§£ï¼Œç»‘å®šåï¼Œå¯åŠ¨è¿‡ç¨‹ä¼šå°†è¯¥æ³¨è§£æŒ‡å®šçš„ç±»å‹çš„å®ç°ç±»ç”Ÿæˆä¸€ä¸ªSetï¼Œä¼ å…¥onStartupæ–¹æ³•
</span><span style="color:#75715e"></span><span style="color:#a6e22e">@HandlesTypes</span><span style="color:#f92672">(</span>WebApplicationInitializer<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SpringServletContainerInitializer</span> <span style="color:#66d9ef">implements</span> ServletContainerInitializer <span style="color:#f92672">{</span>
  <span style="color:#75715e">// webAppInitializerClasseså°±æ˜¯æ”¶é›†åˆ°çš„WebApplicationInitializerçš„æ‰€æœ‰å®ç°ç±»
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">@Override</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onStartup</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@Nullable</span> Set<span style="color:#f92672">&lt;</span>Class<span style="color:#f92672">&lt;?&gt;&gt;</span> webAppInitializerClasses<span style="color:#f92672">,</span> ServletContext servletContext<span style="color:#f92672">)</span>
			<span style="color:#66d9ef">throws</span> ServletException <span style="color:#f92672">{</span>

		List<span style="color:#f92672">&lt;</span>WebApplicationInitializer<span style="color:#f92672">&gt;</span> initializers <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> LinkedList<span style="color:#f92672">&lt;&gt;();</span>

		<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>webAppInitializerClasses <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			<span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Class<span style="color:#f92672">&lt;?&gt;</span> waiClass <span style="color:#f92672">:</span> webAppInitializerClasses<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
				<span style="color:#75715e">// Be defensive: Some servlet containers provide us with invalid classes,
</span><span style="color:#75715e"></span>				<span style="color:#75715e">// no matter what @HandlesTypes says...
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// éæ¥å£ä¸éæŠ½è±¡ç±»
</span><span style="color:#75715e"></span>				<span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>waiClass<span style="color:#f92672">.</span><span style="color:#a6e22e">isInterface</span><span style="color:#f92672">()</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>Modifier<span style="color:#f92672">.</span><span style="color:#a6e22e">isAbstract</span><span style="color:#f92672">(</span>waiClass<span style="color:#f92672">.</span><span style="color:#a6e22e">getModifiers</span><span style="color:#f92672">())</span> <span style="color:#f92672">&amp;&amp;</span>
						WebApplicationInitializer<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">isAssignableFrom</span><span style="color:#f92672">(</span>waiClass<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
					<span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// åå°„å®ä¾‹åŒ–WebApplicationInitializerå¯¹è±¡
</span><span style="color:#75715e"></span>						initializers<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">((</span>WebApplicationInitializer<span style="color:#f92672">)</span>
								ReflectionUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">accessibleConstructor</span><span style="color:#f92672">(</span>waiClass<span style="color:#f92672">).</span><span style="color:#a6e22e">newInstance</span><span style="color:#f92672">());</span>
					<span style="color:#f92672">}</span>
					<span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Throwable ex<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
						<span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> ServletException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Failed to instantiate WebApplicationInitializer class&#34;</span><span style="color:#f92672">,</span> ex<span style="color:#f92672">);</span>
					<span style="color:#f92672">}</span>
				<span style="color:#f92672">}</span>
			<span style="color:#f92672">}</span>
		<span style="color:#f92672">}</span>

		<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>initializers<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
			servletContext<span style="color:#f92672">.</span><span style="color:#a6e22e">log</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;No Spring WebApplicationInitializer types detected on classpath&#34;</span><span style="color:#f92672">);</span>
			<span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
		<span style="color:#f92672">}</span>

		servletContext<span style="color:#f92672">.</span><span style="color:#a6e22e">log</span><span style="color:#f92672">(</span>initializers<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Spring WebApplicationInitializers detected on classpath&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#75715e">// æ’åº
</span><span style="color:#75715e"></span>		AnnotationAwareOrderComparator<span style="color:#f92672">.</span><span style="color:#a6e22e">sort</span><span style="color:#f92672">(</span>initializers<span style="color:#f92672">);</span>
		<span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>WebApplicationInitializer initializer <span style="color:#f92672">:</span> initializers<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      <span style="color:#75715e">// å¯¹ç¾ä¸€ä¸ª WebApplicationInitializer æ‰§è¡Œå¯åŠ¨
</span><span style="color:#75715e"></span>			initializer<span style="color:#f92672">.</span><span style="color:#a6e22e">onStartup</span><span style="color:#f92672">(</span>servletContext<span style="color:#f92672">);</span>
		<span style="color:#f92672">}</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>å› æ­¤å¯ä»¥å‘ç°ï¼Œ<strong>SpringServletContainerInitializer</strong> å°±åƒ spring-web æä¾›çš„ä¸€ä¸ª <strong>WebApplicationInitializer</strong> ä»£ç†å¯¹è±¡ï¼Œä¼šåœ¨Servletå®¹å™¨å¯åŠ¨è¿‡ç¨‹ä¸­çš„æŸä¸ªäº‹ä»¶é˜¶æ®µå»è¿›è¡Œ å¯¹**WebApplicationInitializer.onStartup è¿›è¡Œä»£ç†ï¼Œ**ä»è€Œä¹Ÿä¼šæ„å»ºå‡ºä¸Šè¿°çš„å„ç§ WebApplicationContextã€‚</p>
<p>å› æ­¤åªè¦å¼•å…¥äº†spring-webï¼ˆSpringServletContainerInitializerï¼‰åŠspring-webmvcï¼ˆAbstractDispatcherServletInitializerï¼‰åŒ…ï¼Œé‚£ä¹ˆWebApplicationContextçš„æ„å»ºå°±ä¼šè‡ªç„¶è€Œç„¶çš„å‘ç”Ÿã€‚</p>
<h2 id="ä¸‰éƒ¨åˆ†ç–‘é—®">ä¸‰ã€éƒ¨åˆ†ç–‘é—®</h2>
<h3 id="31-æœ¬åœ°ä½¿ç”¨ideaçš„tomcatéƒ¨ç½²ä¸€ä¸ªspringmvcé¡¹ç›®æŒ‰ç†æ¥è¯´åº”è¯¥æ˜¯ä¼šæ‰§è¡Œåˆ°-orgspringframeworkwebspringservletcontainerinitializeronstartup-æ–¹æ³•çš„ä½†æ˜¯debugå‘ç°å¹¶æ²¡æœ‰ä½¿ç”¨springbootå·¥ç¨‹å¯åŠ¨springmvcé¡¹ç›®å‘ç°ä¹Ÿæ²¡æœ‰æ‰§è¡Œåˆ°-orgspringframeworkwebspringservletcontainerinitializeronstartup-æ–¹æ³•">3.1 æœ¬åœ°ä½¿ç”¨IDEAçš„tomcatéƒ¨ç½²ä¸€ä¸ªSpringMVCé¡¹ç›®ï¼ŒæŒ‰ç†æ¥è¯´åº”è¯¥æ˜¯ä¼šæ‰§è¡Œåˆ° org.springframework.web.SpringServletContainerInitializer#onStartup æ–¹æ³•çš„ï¼Œä½†æ˜¯debugå‘ç°å¹¶æ²¡æœ‰ï¼Ÿä½¿ç”¨SpringBootå·¥ç¨‹å¯åŠ¨springmvcé¡¹ç›®ï¼Œå‘ç°ä¹Ÿæ²¡æœ‰æ‰§è¡Œåˆ° org.springframework.web.SpringServletContainerInitializer#onStartup æ–¹æ³•ï¼Ÿ</h3>
<p>ç­”æ¡ˆï¼š</p>
<p>é’ˆå¯¹IDEA çš„tomcatéƒ¨ç½²springmvcï¼ŒSpringServletContainerInitializeræœªç”Ÿæ•ˆåŸå› æ˜¯ï¼šå·¥ç¨‹çš„web.xmlä¸­é…ç½®äº†<!-- raw HTML omitted -->å…ƒç´ ï¼Œè¿™ä¸ªä¼šå¯¼è‡´ä¸å»æ‰«æJaråŒ…å†…çš„å®ç°ï¼Œå‚è€ƒï¼šhttps://mangocool.com/1607412545816.html</p>
<p>é’ˆå¯¹springbootå·¥ç¨‹ï¼Œå®é™…ä¸Šå¯åŠ¨webé¡¹ç›®ï¼Œä½¿ç”¨çš„é»˜è®¤æ˜¯å†…ç½®çš„tomcatï¼Œä½¿ç”¨çš„ServletContextå®ç°æ˜¯springbootçš„å®ç°ï¼š<strong>org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedContextã€‚</strong> è€Œåœ¨createWebServerçš„æ—¶å€™ï¼Œå…¶å®tomcatçš„æ•´ä¸ªå¯åŠ¨æµç¨‹å·²ç»è¢«æ”¹å†™è¿‡äº†ï¼ŒåŒæ—¶ServletContextçš„æ„å»ºå…¶å®ä¹Ÿæ˜¯è¢«æ”¹å†™äº†ï¼Œä¸åƒåŸæœ¬å¤–ç½®tomcatä¼šé€šè¿‡SPIæœºåˆ¶ï¼Œæ‰¾åˆ°å®ç°ServletContainerInitializeræ¥å£çš„ç±»ï¼Œè€Œåœ¨TomcatEmbeddedContextä¸­ï¼ŒServletContainerInitializerçš„å®ç°å®é™…ä¸Šæ˜¯æ‰‹åŠ¨æ·»åŠ è¿›å»çš„ï¼Œæºç å¦‚ä¸‹ï¼š</p>
<p><strong>org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory#configureContext</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">configureContext</span><span style="color:#f92672">(</span>Context context<span style="color:#f92672">,</span> ServletContextInitializer<span style="color:#f92672">[]</span> initializers<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		TomcatStarter starter <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TomcatStarter<span style="color:#f92672">(</span>initializers<span style="color:#f92672">);</span>
		<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>context <span style="color:#66d9ef">instanceof</span> TomcatEmbeddedContext<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			TomcatEmbeddedContext embeddedContext <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>TomcatEmbeddedContext<span style="color:#f92672">)</span> context<span style="color:#f92672">;</span>
			embeddedContext<span style="color:#f92672">.</span><span style="color:#a6e22e">setStarter</span><span style="color:#f92672">(</span>starter<span style="color:#f92672">);</span>
			embeddedContext<span style="color:#f92672">.</span><span style="color:#a6e22e">setFailCtxIfServletStartFails</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>
		<span style="color:#f92672">}</span>
  	<span style="color:#75715e">// å…¶å®åªå†…ç½®äº†ä¸€ä¸ª TomcatStarter è¿™ä¸ª ServletContainerInitializerå®ç°
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// è€ŒTomcatStarterå…¶å®æ˜¯å¯¹ServletContextInitializerçš„ä»£ç†
</span><span style="color:#75715e"></span>		context<span style="color:#f92672">.</span><span style="color:#a6e22e">addServletContainerInitializer</span><span style="color:#f92672">(</span>starter<span style="color:#f92672">,</span> NO_CLASSES<span style="color:#f92672">);</span>
		<span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>LifecycleListener lifecycleListener <span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">contextLifecycleListeners</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			context<span style="color:#f92672">.</span><span style="color:#a6e22e">addLifecycleListener</span><span style="color:#f92672">(</span>lifecycleListener<span style="color:#f92672">);</span>
		<span style="color:#f92672">}</span>
		<span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Valve valve <span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">contextValves</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			context<span style="color:#f92672">.</span><span style="color:#a6e22e">getPipeline</span><span style="color:#f92672">().</span><span style="color:#a6e22e">addValve</span><span style="color:#f92672">(</span>valve<span style="color:#f92672">);</span>
		<span style="color:#f92672">}</span>
		<span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>ErrorPage errorPage <span style="color:#f92672">:</span> getErrorPages<span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
			<span style="color:#66d9ef">new</span> TomcatErrorPage<span style="color:#f92672">(</span>errorPage<span style="color:#f92672">).</span><span style="color:#a6e22e">addToContext</span><span style="color:#f92672">(</span>context<span style="color:#f92672">);</span>
		<span style="color:#f92672">}</span>
		<span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>MimeMappings<span style="color:#f92672">.</span><span style="color:#a6e22e">Mapping</span> mapping <span style="color:#f92672">:</span> getMimeMappings<span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
			context<span style="color:#f92672">.</span><span style="color:#a6e22e">addMimeMapping</span><span style="color:#f92672">(</span>mapping<span style="color:#f92672">.</span><span style="color:#a6e22e">getExtension</span><span style="color:#f92672">(),</span> mapping<span style="color:#f92672">.</span><span style="color:#a6e22e">getMimeType</span><span style="color:#f92672">());</span>
		<span style="color:#f92672">}</span>
		configureSession<span style="color:#f92672">(</span>context<span style="color:#f92672">);</span>
		<span style="color:#66d9ef">new</span> DisableReferenceClearingContextCustomizer<span style="color:#f92672">().</span><span style="color:#a6e22e">customize</span><span style="color:#f92672">(</span>context<span style="color:#f92672">);</span>
		<span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>TomcatContextCustomizer customizer <span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">tomcatContextCustomizers</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			customizer<span style="color:#f92672">.</span><span style="color:#a6e22e">customize</span><span style="color:#f92672">(</span>context<span style="color:#f92672">);</span>
		<span style="color:#f92672">}</span>
	<span style="color:#f92672">}</span>
</code></pre></div><p><strong>org.springframework.boot.web.embedded.tomcat.TomcatStarter</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TomcatStarter</span> <span style="color:#66d9ef">implements</span> ServletContainerInitializer <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> Log logger <span style="color:#f92672">=</span> LogFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getLog</span><span style="color:#f92672">(</span>TomcatStarter<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>

	<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> ServletContextInitializer<span style="color:#f92672">[]</span> initializers<span style="color:#f92672">;</span>

	<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">volatile</span> Exception startUpException<span style="color:#f92672">;</span>

	TomcatStarter<span style="color:#f92672">(</span>ServletContextInitializer<span style="color:#f92672">[]</span> initializers<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">initializers</span> <span style="color:#f92672">=</span> initializers<span style="color:#f92672">;</span>
	<span style="color:#f92672">}</span>

	<span style="color:#a6e22e">@Override</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onStartup</span><span style="color:#f92672">(</span>Set<span style="color:#f92672">&lt;</span>Class<span style="color:#f92672">&lt;?&gt;&gt;</span> classes<span style="color:#f92672">,</span> ServletContext servletContext<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException <span style="color:#f92672">{</span>
		<span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
      <span style="color:#75715e">// å¯¹ServletContextInitializerçš„ä»£ç†ï¼Œå®é™…ä¸Šå…¨æ‰§è¡ŒServletContextInitializer.onStartup(servletContext);
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// ä½†è¦æ³¨æ„è¿™é‡Œçš„ ServletContextInitializer æ˜¯ org.springframework.boot.web.servlet.ServletContextInitializer
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// æ˜¯spring-bootæä¾›çš„ï¼Œä¸»è¦æ˜¯ä¸ºäº†springç®¡ç†ServletContextInitializer è€Œä¸æ˜¯servletå®¹å™¨æ¥ç®¡ç†
</span><span style="color:#75715e"></span>			<span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>ServletContextInitializer initializer <span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">initializers</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
				initializer<span style="color:#f92672">.</span><span style="color:#a6e22e">onStartup</span><span style="color:#f92672">(</span>servletContext<span style="color:#f92672">);</span>
			<span style="color:#f92672">}</span>
		<span style="color:#f92672">}</span>
		<span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception ex<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">startUpException</span> <span style="color:#f92672">=</span> ex<span style="color:#f92672">;</span>
			<span style="color:#75715e">// Prevent Tomcat from logging and re-throwing when we know we can
</span><span style="color:#75715e"></span>			<span style="color:#75715e">// deal with it in the main thread, but log for information here.
</span><span style="color:#75715e"></span>			<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>logger<span style="color:#f92672">.</span><span style="color:#a6e22e">isErrorEnabled</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
				logger<span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Error starting Tomcat context. Exception: &#34;</span> <span style="color:#f92672">+</span> ex<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;. Message: &#34;</span>
						<span style="color:#f92672">+</span> ex<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">());</span>
			<span style="color:#f92672">}</span>
		<span style="color:#f92672">}</span>
	<span style="color:#f92672">}</span>

	<span style="color:#66d9ef">public</span> Exception <span style="color:#a6e22e">getStartUpException</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">startUpException</span><span style="color:#f92672">;</span>
	<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div>
          </div>
        </div>
                 
      
  
  

  
<div class="disqus-box layout-margin content-padding-large soft-size--large soft-style--box">
    <div id="disqus_thread"></div>
    <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "personalblog-lsl" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  <div class="article-paging">
    
      <section class="post-paging--item card-container content-padding-primary soft-size--primary soft-style--box">
  <div class="card-cover" background-image-lazy data-img="https://raw.githubusercontent.com/jxsrlsl1234/public-images/master/blogs/cover-3.png"></div>
  <div class="card-text">
    <a href="/blogs/springboot%E9%A1%B9%E7%9B%AE%E5%9C%A8jvm%E9%80%80%E5%87%BA%E6%97%B6%E6%97%A5%E5%BF%97%E4%B8%A2%E5%A4%B1%E6%83%85%E5%86%B5%E5%88%86%E6%9E%90/"><h4 class="card-text--title text-ellipsis">SpringBooté¡¹ç›®åœ¨JVMé€€å‡ºæ—¶æ—¥å¿—ä¸¢å¤±æƒ…å†µåˆ†æ</h4></a>
    <p class="card-text--row">2022-12-22 15:50</p>
  </div>
</section>
    
    
      <section class="post-paging--item card-container content-padding-primary soft-size--primary soft-style--box">
  <div class="card-cover" background-image-lazy data-img="https://raw.githubusercontent.com/jxsrlsl1234/public-images/master/blogs/89882843_p0_master1200.jpeg"></div>
  <div class="card-text">
    <a href="/blogs/%E8%87%AA%E5%AE%9A%E4%B9%89tomcat%E4%BC%98%E9%9B%85%E9%80%80%E5%87%BA%E9%80%BB%E8%BE%91/"><h4 class="card-text--title text-ellipsis">è‡ªå®šä¹‰Tomcatä¼˜é›…é€€å‡ºé€»è¾‘</h4></a>
    <p class="card-text--row">2022-12-05 16:25</p>
  </div>
</section>
    
  </div>
</div>
  <aside class="widget-info">
    
<section class="aside-widget widget-author content-padding-large soft-size--large soft-style--box">
  <div class="widget-body">
    <div class="author-box avatar">
      
      <img class="author-avatar soft-size--round soft-style--box" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Flmg.jj20.com%2Fup%2Fallimg%2Ftx26%2F01080117025728.jpg&amp;refer=http%3A%2F%2Flmg.jj20.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1672826145&amp;t=a153646188cf215f2f529313c26f70de" alt="jxsrlsl1234">
      
      <h2 class="author-name text-ellipsis">jxsrlsl1234</h2>
      
      <p class="author-desc text-ellipsis">ä¸€ä¸ªåŠªåŠ›å¥‹æ–—çš„ç¤¾ç•œ</p>
      
    </div>
  </div>
</section>


    


    






<section class="aside-widget widget-articles content-padding-large soft-size--large soft-style--box">
  <h2 class="widget-header">
    <div class="title">
      <span>Related Posts</span>
    </div>
  </h2>
  <div class="widget-body">
    <ul class="post-list">
      
      
        <li class="post-item"><a href="/blogs/springboot%E9%A1%B9%E7%9B%AE%E5%9C%A8jvm%E9%80%80%E5%87%BA%E6%97%B6%E6%97%A5%E5%BF%97%E4%B8%A2%E5%A4%B1%E6%83%85%E5%86%B5%E5%88%86%E6%9E%90/">SpringBooté¡¹ç›®åœ¨JVMé€€å‡ºæ—¶æ—¥å¿—ä¸¢å¤±æƒ…å†µåˆ†æ</a></li>
      
        <li class="post-item"><a href="/blogs/%E8%87%AA%E5%AE%9A%E4%B9%89tomcat%E4%BC%98%E9%9B%85%E9%80%80%E5%87%BA%E9%80%BB%E8%BE%91/">è‡ªå®šä¹‰Tomcatä¼˜é›…é€€å‡ºé€»è¾‘</a></li>
      
    </ul>
  </div>
</section>


    




<section class="aside-widget widget-categories content-padding-large soft-size--large soft-style--box">
  <h2 class="widget-header">
    <div class="title">
      <span>Categories</span>
    </div>
  </h2>
  <div class="widget-body">
    <ul class="categories-list">
      
        <li>
          <a href="https://jxsrlsl1234.github.io/categories/java/">Java</a>
          <span>3</span>
        </li>
      
    </ul>
  </div>

  
</section>


    




<section class="aside-widget widget-tags content-padding-large soft-size--large soft-style--box">
  <h2 class="widget-header">
    <div class="title">
      <span>Tags</span>
    </div>
  </h2>
  <div class="widget-body">
    <div class="tags-list">
      
        <a href="https://jxsrlsl1234.github.io/tags/springboot/" data-count="2" class="soft-size--small soft-style--hover soft-style--active">SpringBoot</a>
      
        <a href="https://jxsrlsl1234.github.io/tags/jvm/" data-count="1" class="soft-size--small soft-style--hover soft-style--active">JVM</a>
      
        <a href="https://jxsrlsl1234.github.io/tags/sentinel/" data-count="1" class="soft-size--small soft-style--hover soft-style--active">Sentinel</a>
      
        <a href="https://jxsrlsl1234.github.io/tags/spring/" data-count="1" class="soft-size--small soft-style--hover soft-style--active">Spring</a>
      
        <a href="https://jxsrlsl1234.github.io/tags/springmvc/" data-count="1" class="soft-size--small soft-style--hover soft-style--active">SpringMVC</a>
      
        <a href="https://jxsrlsl1234.github.io/tags/tomcat/" data-count="1" class="soft-size--small soft-style--hover soft-style--active">Tomcat</a>
      
        <a href="https://jxsrlsl1234.github.io/tags/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/" data-count="1" class="soft-size--small soft-style--hover soft-style--active">æ—¥å¿—æ¡†æ¶</a>
      
    </div>
  </div>

  
</section>

  </aside>
</div>
  </main><footer class="footer-container layout-block">
  
  <div class="social-icons">
    
      <a class="soft-size--primary soft-style--box" href="https://github.com/jxsrlsl1234" target="_blank" rel="noopener noreferrer">
          
        <svg class="icon icon-github" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
          <path d="M64.6 512c0 195.6 125.4 361.9 300.1 422.9 23.5 5.9 19.9-10.8 19.9-22.2v-77.6c-135.8 15.9-141.3-74-150.5-89-18.5-31.5-61.9-39.5-49-54.5 31-15.9 62.5 4 98.9 58 26.4 39.1 77.9 32.5 104.1 26 5.7-23.5 17.9-44.5 34.7-60.9-140.7-25.2-199.4-111.1-199.4-213.3 0-49.5 16.4-95.1 48.4-131.8-20.4-60.6 1.9-112.4 4.9-120.1 58.2-5.2 118.5 41.6 123.3 45.3 33.1-8.9 70.8-13.7 112.9-13.7 42.4 0 80.3 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.4-43.9 2.9 7.7 24.7 58.3 5.5 118.1 32.5 36.8 49 82.8 49 132.4 0 102.3-59 188.3-200.2 213.2 23.5 23.3 38.1 55.5 38.1 91.1v112.7c0.8 9 0 17.9 15.1 17.9C832.7 877 960.4 709.4 960.4 512.1c0-247.5-200.6-447.9-447.9-447.9C265 64.1 64.6 264.5 64.6 512z"></path>
        </svg>
        

        

        

        

        
      </a>
    
  </div>
  

  <div class="colour-bar"></div>
  
  
  <p>Â© 2021 <a href="https://github.com/miiiku/hugo-theme-kagome">kagome</a>.</p>
  

  

  <p>
    Powered by
    <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a>
    Theme - 
    <a href="https://github.com/miiiku/hugo-theme-kagome" target="_blank" rel="noopener noreferrer author">kagome</a>
  </p>

  <p>
    <a href="javascript:;" id="theme-light">ğŸŒ light</a>
    <a href="javascript:;" id="theme-dark">ğŸŒ› dark</a>
    <a href="javascript:;" id="theme-auto">ğŸ¤–ï¸ auto</a>
  </p>
</footer>








</body>

</html>